<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phase 3 - Data Pipeline Architecture (Draw.io Style)</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Helvetica Neue', Arial, sans-serif;
    background: #f5f5f5;
    padding: 30px;
  }

  .container {
    max-width: 1600px;
    margin: 0 auto;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 40px;
  }

  h1 {
    text-align: center;
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 10px;
    color: #1a1a1a;
  }

  .subtitle {
    text-align: center;
    font-size: 14px;
    color: #666;
    margin-bottom: 30px;
  }

  svg {
    display: block;
    margin: 0 auto;
    background: white;
    border: 1px solid #e0e0e0;
  }

  /* Draw.io style elements */
  .box {
    cursor: pointer;
  }

  .box rect {
    stroke-width: 1;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.15));
  }

  .box:hover rect {
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.25));
  }

  .box text {
    pointer-events: none;
  }

  /* Tooltip */
  .tooltip {
    position: fixed;
    pointer-events: none;
    padding: 10px 14px;
    border-radius: 4px;
    background: #333;
    color: white;
    font-size: 12px;
    line-height: 1.5;
    max-width: 320px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    opacity: 0;
    transition: opacity 0.2s;
    z-index: 100;
    font-family: 'Helvetica Neue', Arial, sans-serif;
  }

  .tooltip.show { opacity: 1; }
  .tooltip strong { color: #4fc3f7; }
  .tooltip code {
    background: #444;
    padding: 2px 4px;
    border-radius: 2px;
    font-family: 'Courier New', monospace;
    font-size: 11px;
    color: #ffeb3b;
  }

  /* Legend */
  .legend {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin-top: 30px;
    padding: 15px;
    background: #fafafa;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: #333;
  }

  .legend-box {
    width: 20px;
    height: 14px;
    border: 1px solid #999;
    border-radius: 2px;
  }

  .legend-line {
    width: 30px;
    height: 2px;
    border-radius: 1px;
  }

  /* Info section */
  .info-section {
    margin-top: 30px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
  }

  .info-card {
    background: #fafafa;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 18px;
  }

  .info-card h3 {
    font-size: 15px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 10px;
    border-bottom: 2px solid #2196f3;
    padding-bottom: 6px;
  }

  .info-card ul {
    margin: 0;
    padding: 0;
    list-style: none;
  }

  .info-card li {
    padding: 4px 0;
    font-size: 13px;
    color: #555;
  }

  .info-card li::before {
    content: "â–¸ ";
    color: #2196f3;
    font-weight: bold;
  }

  .tech-badge {
    display: inline-block;
    background: #e3f2fd;
    color: #1976d2;
    padding: 3px 8px;
    border-radius: 3px;
    font-size: 11px;
    font-weight: 500;
    margin: 4px 4px 0 0;
  }
</style>
</head>
<body>

<div class="container">
  <h1>NYC Taxi Data Pipeline Architecture</h1>
  <p class="subtitle">Phase 3: Hybrid Batch + Streaming | Medallion Architecture | Docker Orchestration</p>

  <svg width="1500" height="900" viewBox="0 0 1500 900">
    <defs>
      <!-- Arrow markers -->
      <marker id="arrow-end" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
        <path d="M0,0 L0,6 L9,3 z" fill="#666"/>
      </marker>
      <marker id="arrow-batch" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
        <path d="M0,0 L0,6 L9,3 z" fill="#ff9800"/>
      </marker>
      <marker id="arrow-stream" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
        <path d="M0,0 L0,6 L9,3 z" fill="#2196f3"/>
      </marker>
      <marker id="arrow-transform" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
        <path d="M0,0 L0,6 L9,3 z" fill="#9c27b0"/>
      </marker>
      <marker id="arrow-viz" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
        <path d="M0,0 L0,6 L9,3 z" fill="#4caf50"/>
      </marker>
    </defs>

    <!-- Swim Lanes -->
    <g id="swim-lanes">
      <!-- Stage 1: Ingest -->
      <rect x="20" y="80" width="300" height="620" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="4"/>
      <text x="170" y="65" text-anchor="middle" font-size="14" font-weight="600" fill="#e65100">STAGE 1: INGEST</text>

      <!-- Stage 2: Transform -->
      <rect x="340" y="80" width="380" height="620" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" rx="4"/>
      <text x="530" y="65" text-anchor="middle" font-size="14" font-weight="600" fill="#6a1b9a">STAGE 2: TRANSFORM</text>

      <!-- Stage 3: Store -->
      <rect x="740" y="80" width="380" height="620" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="4"/>
      <text x="930" y="65" text-anchor="middle" font-size="14" font-weight="600" fill="#0d47a1">STAGE 3: STORE</text>

      <!-- Stage 4: Visualize -->
      <rect x="1140" y="80" width="300" height="620" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="4"/>
      <text x="1290" y="65" text-anchor="middle" font-size="14" font-weight="600" fill="#1b5e20">STAGE 4: VISUALIZE</text>
    </g>

    <!-- STAGE 1: INGEST -->
    <!-- NYC TLC API -->
    <g class="box" data-tip="<strong>NYC TLC Data API</strong><br>Public API providing Yellow/Green/FHV taxi trip records<br>Format: Parquet files<br>URL: https://www.nyc.gov/tlc">
      <rect x="50" y="120" width="240" height="70" fill="#fff" stroke="#ff9800" stroke-width="2" rx="4"/>
      <text x="170" y="145" text-anchor="middle" font-size="14" font-weight="600" fill="#e65100">NYC TLC API</text>
      <text x="170" y="165" text-anchor="middle" font-size="11" fill="#666">Yellow/Green Taxi Data</text>
      <text x="170" y="180" text-anchor="middle" font-size="10" fill="#999">(Parquet Format)</text>
    </g>

    <!-- Path Labels -->
    <rect x="50" y="210" width="110" height="40" fill="#ffe0b2" stroke="#ff9800" stroke-width="1.5" rx="4"/>
    <text x="105" y="227" text-anchor="middle" font-size="11" font-weight="600" fill="#e65100">BATCH PATH</text>
    <text x="105" y="242" text-anchor="middle" font-size="9" fill="#f57c00">(Primary)</text>

    <rect x="180" y="210" width="110" height="40" fill="#bbdefb" stroke="#2196f3" stroke-width="1.5" rx="4"/>
    <text x="235" y="227" text-anchor="middle" font-size="11" font-weight="600" fill="#0d47a1">STREAM PATH</text>
    <text x="235" y="242" text-anchor="middle" font-size="9" fill="#1976d2">(Alternative)</text>

    <!-- Apache Kafka -->
    <g class="box" data-tip="<strong>Apache Kafka 3.4</strong><br>Distributed streaming platform<br>Topic: <code>trips_raw</code> (3 partitions)<br>Bootstrap: kafka:9092<br>Requires: Zookeeper 3.8">
      <rect x="50" y="280" width="240" height="70" fill="#fff" stroke="#2196f3" stroke-width="2" rx="4"/>
      <text x="170" y="305" text-anchor="middle" font-size="14" font-weight="600" fill="#0d47a1">Apache Kafka</text>
      <text x="170" y="325" text-anchor="middle" font-size="11" fill="#666">Topic: trips_raw</text>
      <text x="170" y="340" text-anchor="middle" font-size="10" fill="#999">Port: 9092</text>
    </g>

    <!-- Kafka Dependencies -->
    <g class="box" data-tip="<strong>Zookeeper 3.8</strong><br>Kafka cluster coordination service<br>Port: 2181">
      <rect x="50" y="370" width="240" height="50" fill="#fff" stroke="#607d8b" stroke-width="1.5" rx="4" stroke-dasharray="4,2"/>
      <text x="170" y="395" text-anchor="middle" font-size="12" font-weight="500" fill="#455a64">Zookeeper 3.8</text>
      <text x="170" y="410" text-anchor="middle" font-size="9" fill="#999">Kafka Coordination</text>
    </g>

    <!-- Python Scripts -->
    <g class="box" data-tip="<strong>Ingestion Scripts</strong><br>Batch: <code>download_nyc_tlc.py</code><br>Stream: <code>kafka_producer.py</code><br>Scheduled via Airflow">
      <rect x="50" y="450" width="240" height="60" fill="#fafafa" stroke="#999" stroke-width="1.5" rx="4"/>
      <text x="170" y="473" text-anchor="middle" font-size="12" font-weight="600" fill="#333">Python Scripts</text>
      <text x="170" y="490" text-anchor="middle" font-size="10" fill="#666">download_nyc_tlc.py</text>
      <text x="170" y="502" text-anchor="middle" font-size="10" fill="#666">kafka_producer.py</text>
    </g>

    <!-- STAGE 2: TRANSFORM -->
    <!-- Spark Master -->
    <g class="box" data-tip="<strong>Apache Spark Master</strong><br>Cluster manager for distributed processing<br>Version: Spark 3.1.2 + Hadoop 3.2<br>Ports: 8080 (UI), 7077 (cluster)<br>URL: spark://spark-master:7077">
      <rect x="370" y="120" width="150" height="70" fill="#fff" stroke="#9c27b0" stroke-width="2" rx="4"/>
      <text x="445" y="145" text-anchor="middle" font-size="14" font-weight="600" fill="#6a1b9a">Spark Master</text>
      <text x="445" y="165" text-anchor="middle" font-size="11" fill="#666">Cluster Manager</text>
      <text x="445" y="180" text-anchor="middle" font-size="10" fill="#999">:8080 / :7077</text>
    </g>

    <!-- Spark Worker -->
    <g class="box" data-tip="<strong>Spark Worker</strong><br>Task executor node<br>Port: 8081 (UI)<br>Executes Spark jobs">
      <rect x="540" y="120" width="150" height="70" fill="#fff" stroke="#9c27b0" stroke-width="1.5" rx="4" stroke-dasharray="4,2"/>
      <text x="615" y="145" text-anchor="middle" font-size="13" font-weight="500" fill="#7b1fa2">Spark Worker</text>
      <text x="615" y="165" text-anchor="middle" font-size="11" fill="#666">Task Executor</text>
      <text x="615" y="180" text-anchor="middle" font-size="10" fill="#999">:8081</text>
    </g>

    <!-- Medallion Layers -->
    <!-- Bronze -->
    <g class="box" data-tip="<strong>Bronze Layer (Raw)</strong><br>Immutable raw data ingestion<br>Path: <code>/datalake/nyc/bronze/yellow_tripdata</code><br>Format: Parquet (partitioned by year/month)<br>Job: Direct load or Kafka consumer">
      <rect x="370" y="240" width="150" height="80" fill="#fff" stroke="#9c27b0" stroke-width="2" rx="4"/>
      <rect x="370" y="240" width="150" height="25" fill="#e1bee7" stroke="none" rx="4"/>
      <text x="445" y="257" text-anchor="middle" font-size="13" font-weight="600" fill="#4a148c">Bronze Layer</text>
      <text x="445" y="280" text-anchor="middle" font-size="10" fill="#666">Raw Ingestion</text>
      <text x="445" y="295" text-anchor="middle" font-size="9" fill="#999">HDFS: /bronze/</text>
      <text x="445" y="310" text-anchor="middle" font-size="9" fill="#999">Partitioned Parquet</text>
    </g>

    <!-- Silver -->
    <g class="box" data-tip="<strong>Silver Layer (Cleaned)</strong><br>Validated and cleaned data<br>Path: <code>/datalake/nyc/silver/yellow_tripdata</code><br>Job: <code>nyc_bronze_to_silver.py</code><br>Filters: trip_distance > 0, fare >= 0<br>DQ: <code>dq_check_silver.py</code>">
      <rect x="370" y="370" width="150" height="80" fill="#fff" stroke="#9c27b0" stroke-width="2" rx="4"/>
      <rect x="370" y="370" width="150" height="25" fill="#cfd8dc" stroke="none" rx="4"/>
      <text x="445" y="387" text-anchor="middle" font-size="13" font-weight="600" fill="#37474f">Silver Layer</text>
      <text x="445" y="410" text-anchor="middle" font-size="10" fill="#666">Cleaned & Validated</text>
      <text x="445" y="425" text-anchor="middle" font-size="9" fill="#999">HDFS: /silver/</text>
      <text x="445" y="440" text-anchor="middle" font-size="9" fill="#999">DQ Checked</text>
    </g>

    <!-- Gold -->
    <g class="box" data-tip="<strong>Gold Layer (Aggregated)</strong><br>Business-ready KPI aggregations<br>Path: <code>/datalake/nyc/gold/kpis_trips_monthly</code><br>Job: <code>nyc_silver_to_gold.py</code><br>Metrics: trip count, total fare, avg distance<br>Output: HDFS + PostgreSQL (JDBC)">
      <rect x="370" y="500" width="150" height="80" fill="#fff" stroke="#9c27b0" stroke-width="2" rx="4"/>
      <rect x="370" y="500" width="150" height="25" fill="#fff9c4" stroke="none" rx="4"/>
      <text x="445" y="517" text-anchor="middle" font-size="13" font-weight="600" fill="#f57f17">Gold Layer</text>
      <text x="445" y="540" text-anchor="middle" font-size="10" fill="#666">Aggregated KPIs</text>
      <text x="445" y="555" text-anchor="middle" font-size="9" fill="#999">HDFS: /gold/</text>
      <text x="445" y="570" text-anchor="middle" font-size="9" fill="#999">Monthly Aggregates</text>
    </g>

    <!-- Spark Jobs Labels -->
    <rect x="540" y="270" width="150" height="30" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1" rx="4"/>
    <text x="615" y="290" text-anchor="middle" font-size="10" font-weight="600" fill="#6a1b9a">nyc_bronze_to_silver.py</text>

    <rect x="540" y="400" width="150" height="30" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1" rx="4"/>
    <text x="615" y="420" text-anchor="middle" font-size="10" font-weight="600" fill="#6a1b9a">nyc_silver_to_gold.py</text>

    <rect x="540" y="530" width="150" height="30" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1" rx="4"/>
    <text x="615" y="550" text-anchor="middle" font-size="10" font-weight="600" fill="#6a1b9a">evaluate_gold_metrics.py</text>

    <!-- STAGE 3: STORE -->
    <!-- HDFS NameNode -->
    <g class="box" data-tip="<strong>HDFS NameNode</strong><br>Hadoop Distributed File System metadata<br>Version: Hadoop 3.2.1<br>Ports: 9870 (UI), 9000 (RPC)<br>Stores: Bronze/Silver/Gold layers">
      <rect x="770" y="120" width="160" height="70" fill="#fff" stroke="#2196f3" stroke-width="2" rx="4"/>
      <text x="850" y="145" text-anchor="middle" font-size="14" font-weight="600" fill="#0d47a1">HDFS NameNode</text>
      <text x="850" y="165" text-anchor="middle" font-size="11" fill="#666">Metadata Manager</text>
      <text x="850" y="180" text-anchor="middle" font-size="10" fill="#999">:9870 / :9000</text>
    </g>

    <!-- HDFS DataNode -->
    <g class="box" data-tip="<strong>HDFS DataNode</strong><br>Stores actual data blocks<br>Port: 9864 (UI)<br>Volume: hdfs-datanode">
      <rect x="950" y="120" width="140" height="70" fill="#fff" stroke="#2196f3" stroke-width="1.5" rx="4" stroke-dasharray="4,2"/>
      <text x="1020" y="145" text-anchor="middle" font-size="13" font-weight="500" fill="#1565c0">HDFS DataNode</text>
      <text x="1020" y="165" text-anchor="middle" font-size="11" fill="#666">Data Blocks</text>
      <text x="1020" y="180" text-anchor="middle" font-size="10" fill="#999">:9864</text>
    </g>

    <!-- Medallion Summary -->
    <g class="box" data-tip="<strong>Medallion Architecture</strong><br>Three-tier data quality layers<br>ðŸ¥‰ Bronze: Raw immutable data<br>ðŸ¥ˆ Silver: Cleaned validated data<br>ðŸ¥‡ Gold: Aggregated business KPIs">
      <rect x="770" y="220" width="320" height="100" fill="#fafafa" stroke="#2196f3" stroke-width="1.5" rx="4"/>
      <text x="930" y="245" text-anchor="middle" font-size="13" font-weight="600" fill="#0d47a1">Medallion Architecture</text>
      <text x="930" y="265" text-anchor="middle" font-size="11" fill="#666">ðŸ¥‰ Bronze Layer: Raw (Immutable)</text>
      <text x="930" y="283" text-anchor="middle" font-size="11" fill="#666">ðŸ¥ˆ Silver Layer: Cleaned (Validated)</text>
      <text x="930" y="301" text-anchor="middle" font-size="11" fill="#666">ðŸ¥‡ Gold Layer: Aggregated (KPIs)</text>
    </g>

    <!-- PostgreSQL -->
    <g class="box" data-tip="<strong>PostgreSQL 15</strong><br>Relational data warehouse<br>Database: nyc<br>Tables: fact_trips_monthly, taxi_zone_lookup, dq_results, job_runs, metrics_pipeline_runs<br>Port: 5432<br>Access: Spark (JDBC) + Superset">
      <rect x="770" y="350" width="320" height="90" fill="#fff" stroke="#2196f3" stroke-width="2" rx="4"/>
      <text x="930" y="375" text-anchor="middle" font-size="14" font-weight="600" fill="#0d47a1">PostgreSQL 15</text>
      <text x="930" y="395" text-anchor="middle" font-size="11" fill="#666">Data Warehouse (OLAP)</text>
      <text x="930" y="413" text-anchor="middle" font-size="10" fill="#999">Tables: fact_trips_monthly, dq_results,</text>
      <text x="930" y="428" text-anchor="middle" font-size="10" fill="#999">taxi_zone_lookup, job_runs, metrics</text>
    </g>

    <!-- Adminer -->
    <g class="box" data-tip="<strong>Adminer</strong><br>Lightweight database management UI<br>Ad-hoc SQL queries and debugging<br>Port: 8082">
      <rect x="770" y="460" width="320" height="50" fill="#fafafa" stroke="#607d8b" stroke-width="1.5" rx="4"/>
      <text x="930" y="482" text-anchor="middle" font-size="12" font-weight="600" fill="#455a64">Adminer</text>
      <text x="930" y="498" text-anchor="middle" font-size="10" fill="#666">DB Management UI (:8082)</text>
    </g>

    <!-- STAGE 4: VISUALIZE -->
    <!-- Superset -->
    <g class="box" data-tip="<strong>Apache Superset 3.1.0</strong><br>Modern BI and data visualization platform<br>Dashboards: Trip trends, Revenue analysis, DQ metrics, Pipeline performance<br>Connects to: PostgreSQL (nyc database)<br>Port: 8089<br>URL: http://localhost:8089">
      <rect x="1170" y="180" width="240" height="90" fill="#fff" stroke="#4caf50" stroke-width="2" rx="4"/>
      <text x="1290" y="208" text-anchor="middle" font-size="14" font-weight="600" fill="#1b5e20">Apache Superset</text>
      <text x="1290" y="228" text-anchor="middle" font-size="11" fill="#666">BI Dashboards & Analytics</text>
      <text x="1290" y="245" text-anchor="middle" font-size="10" fill="#999">Trip Trends | Revenue Analysis</text>
      <text x="1290" y="260" text-anchor="middle" font-size="10" fill="#999">DQ Metrics | Performance</text>
    </g>

    <!-- Dashboard Types -->
    <rect x="1170" y="290" width="240" height="70" fill="#f1f8e9" stroke="#4caf50" stroke-width="1" rx="4"/>
    <text x="1290" y="310" text-anchor="middle" font-size="11" font-weight="600" fill="#33691e">Interactive Dashboards</text>
    <text x="1290" y="327" text-anchor="middle" font-size="9" fill="#558b2f">ðŸ“Š Monthly trip volume trends</text>
    <text x="1290" y="341" text-anchor="middle" font-size="9" fill="#558b2f">ðŸ’° Revenue & tip analysis</text>
    <text x="1290" y="355" text-anchor="middle" font-size="9" fill="#558b2f">âœ“ Data quality metrics</text>

    <!-- ORCHESTRATION LAYER (Bottom) -->
    <g class="box" data-tip="<strong>Apache Airflow 2.9.3</strong><br>Workflow orchestration platform<br>DAGs: 4 pipelines<br>â€¢ nyc_taxi_batch (monthly)<br>â€¢ nyc_taxi_kafka_batch (manual)<br>â€¢ load_taxi_zone_lookup_daily<br>â€¢ nyc_phase3_eval<br>Components: Webserver, Scheduler, Executor<br>Port: 8083 | Credentials: airflow/airflow">
      <rect x="50" y="760" width="1390" height="90" fill="#fff" stroke="#f06292" stroke-width="2" rx="4"/>
      <rect x="50" y="760" width="1390" height="30" fill="#fce4ec" stroke="none" rx="4"/>
      <text x="745" y="782" text-anchor="middle" font-size="15" font-weight="600" fill="#880e4f">Apache Airflow 2.9.3 â€“ Workflow Orchestration</text>
      <text x="745" y="810" text-anchor="middle" font-size="11" fill="#666">4 DAGs: nyc_taxi_batch (monthly) | nyc_taxi_kafka_batch (manual) | load_taxi_zone_lookup_daily | nyc_phase3_eval</text>
      <text x="745" y="828" text-anchor="middle" font-size="10" fill="#999">Operators: SparkSubmitOperator, PythonOperator, BashOperator | Port: 8083 | LocalExecutor</text>
    </g>

    <!-- DATA FLOW CONNECTORS (Right-angle style like draw.io) -->
    <!-- Batch Path: NYC TLC â†’ Bronze -->
    <path d="M 170,190 L 170,230 M 105,230 L 105,480 L 320,480 L 320,260 L 365,260"
          stroke="#ff9800" stroke-width="2.5" fill="none" marker-end="url(#arrow-batch)"/>
    <text x="180" y="220" font-size="9" font-weight="600" fill="#e65100">Batch Download</text>

    <!-- Streaming Path: NYC TLC â†’ Kafka â†’ Spark â†’ Bronze -->
    <path d="M 235,250 L 235,280 M 290,315 L 330,315 L 330,155 L 365,155"
          stroke="#2196f3" stroke-width="2.5" fill="none" marker-end="url(#arrow-stream)"/>
    <text x="300" y="310" font-size="9" font-weight="600" fill="#1565c0">Kafka Stream</text>

    <!-- Spark Jobs: Master â†’ Layers -->
    <path d="M 520,155 L 540,155 L 540,280 L 520,280"
          stroke="#9c27b0" stroke-width="2" fill="none" marker-end="url(#arrow-transform)"/>
    <path d="M 445,320 L 445,365"
          stroke="#9c27b0" stroke-width="2.5" fill="none" marker-end="url(#arrow-transform)"/>
    <path d="M 445,450 L 445,495"
          stroke="#9c27b0" stroke-width="2.5" fill="none" marker-end="url(#arrow-transform)"/>

    <!-- Layers â†’ HDFS -->
    <path d="M 520,280 L 765,155"
          stroke="#2196f3" stroke-width="2" fill="none" marker-end="url(#arrow-end)"/>
    <path d="M 520,410 L 700,410 L 700,180 L 765,180"
          stroke="#2196f3" stroke-width="2" fill="none" marker-end="url(#arrow-end)"/>
    <path d="M 520,540 L 730,540 L 730,190 L 765,190"
          stroke="#2196f3" stroke-width="2" fill="none" marker-end="url(#arrow-end)"/>

    <!-- Gold â†’ PostgreSQL (JDBC) -->
    <path d="M 520,540 L 760,540 L 760,395 L 765,395"
          stroke="#2196f3" stroke-width="2.5" fill="none" marker-end="url(#arrow-end)"/>
    <text x="630" y="535" font-size="9" font-weight="600" fill="#1565c0">JDBC Write</text>

    <!-- PostgreSQL â†’ Superset -->
    <path d="M 1090,395 L 1160,395 L 1160,225 L 1165,225"
          stroke="#4caf50" stroke-width="2.5" fill="none" marker-end="url(#arrow-viz)"/>
    <text x="1105" y="390" font-size="9" font-weight="600" fill="#2e7d32">SQL Queries</text>

    <!-- PostgreSQL â†’ Adminer -->
    <path d="M 930,440 L 930,455"
          stroke="#607d8b" stroke-width="2" fill="none" stroke-dasharray="4,2" marker-end="url(#arrow-end)"/>

    <!-- Airflow Orchestration -->
    <path d="M 170,510 L 170,755"
          stroke="#f06292" stroke-width="2" fill="none" stroke-dasharray="5,3" marker-end="url(#arrow-end)"/>
    <path d="M 445,580 L 445,755"
          stroke="#f06292" stroke-width="2" fill="none" stroke-dasharray="5,3" marker-end="url(#arrow-end)"/>
    <path d="M 615,560 L 615,755"
          stroke="#f06292" stroke-width="2" fill="none" stroke-dasharray="5,3" marker-end="url(#arrow-end)"/>

    <text x="180" y="630" font-size="9" font-weight="600" fill="#c2185b">Schedules & Orchestrates</text>

  </svg>

  <!-- Legend -->
  <div class="legend">
    <div class="legend-item">
      <div class="legend-line" style="background:#ff9800;"></div>
      <span>Batch Ingestion (Primary)</span>
    </div>
    <div class="legend-item">
      <div class="legend-line" style="background:#2196f3;"></div>
      <span>Streaming Ingestion (Alternative)</span>
    </div>
    <div class="legend-item">
      <div class="legend-line" style="background:#9c27b0;"></div>
      <span>Spark Transformations</span>
    </div>
    <div class="legend-item">
      <div class="legend-line" style="background:#4caf50;"></div>
      <span>Visualization Query</span>
    </div>
    <div class="legend-item">
      <div class="legend-line" style="background:#f06292; opacity: 0.5;"></div>
      <span>Airflow Orchestration</span>
    </div>
  </div>

  <!-- Info Cards -->
  <div class="info-section">
    <div class="info-card">
      <h3>Docker Services (11 Containers)</h3>
      <ul>
        <li>namenode, datanode (HDFS)</li>
        <li>spark-master, spark-worker-1, spark-history</li>
        <li>postgres (nyc), airflow-db</li>
        <li>kafka, zookeeper</li>
        <li>airflow-webserver, airflow-scheduler, airflow-init</li>
        <li>superset, adminer</li>
      </ul>
      <div style="margin-top: 10px;">
        <span class="tech-badge">docker-compose up -d</span>
      </div>
    </div>

    <div class="info-card">
      <h3>Key Technologies</h3>
      <ul>
        <li>Apache Spark 3.1.2 (PySpark)</li>
        <li>Hadoop HDFS 3.2.1</li>
        <li>Apache Kafka 3.4 + Zookeeper 3.8</li>
        <li>PostgreSQL 15</li>
        <li>Apache Airflow 2.9.3</li>
        <li>Apache Superset 3.1.0</li>
      </ul>
    </div>

    <div class="info-card">
      <h3>Data Flow Summary</h3>
      <ul>
        <li><strong>Ingest:</strong> NYC TLC â†’ Kafka (optional) â†’ Spark â†’ HDFS Bronze</li>
        <li><strong>Transform:</strong> Bronze â†’ Silver â†’ Gold (Medallion)</li>
        <li><strong>Store:</strong> HDFS (data lake) + PostgreSQL (warehouse)</li>
        <li><strong>Visualize:</strong> Superset dashboards from PostgreSQL</li>
      </ul>
    </div>

    <div class="info-card">
      <h3>Airflow DAGs</h3>
      <ul>
        <li><strong>nyc_taxi_batch:</strong> Monthly batch pipeline (@monthly)</li>
        <li><strong>nyc_taxi_kafka_batch:</strong> Streaming pipeline (manual)</li>
        <li><strong>load_taxi_zone_lookup_daily:</strong> Reference data (daily)</li>
        <li><strong>nyc_phase3_eval:</strong> DQ checks + metrics (manual)</li>
      </ul>
    </div>
  </div>

  <div style="margin-top: 30px; text-align: center; color: #666; font-size: 13px; padding: 20px; background: #fafafa; border-top: 2px solid #e0e0e0;">
    <p><strong>Vamshi Krishna Kasarla</strong> | IU MSc Data Science â€“ DLMDSEDE02 (Data Engineering) | Phase 3 Submission</p>
    <p style="margin-top: 5px; font-size: 11px;">Hybrid Architecture: Batch Processing (Primary) + Kafka Streaming (Alternative)</p>
  </div>
</div>

<!-- Tooltip Element -->
<div class="tooltip" id="tip"></div>

<script>
  const tip = document.getElementById('tip');
  document.querySelectorAll('.box').forEach(n => {
    n.addEventListener('mouseenter', e => {
      tip.innerHTML = n.dataset.tip;
      tip.classList.add('show');
    });
    n.addEventListener('mousemove', e => {
      tip.style.left = (e.clientX + 16) + 'px';
      tip.style.top  = (e.clientY + 16) + 'px';
    });
    n.addEventListener('mouseleave', () => tip.classList.remove('show'));
  });
</script>
</body>
</html>
