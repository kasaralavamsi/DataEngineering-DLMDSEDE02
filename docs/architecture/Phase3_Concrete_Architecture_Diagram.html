<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phase 3 - Concrete Data Pipeline Architecture</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #2d3748;
    min-height: 100vh;
    padding: 40px 20px;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    padding: 40px;
  }

  h1 {
    text-align: center;
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 10px;
    color: #1a202c;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .subtitle {
    text-align: center;
    font-size: 1.1rem;
    color: #718096;
    margin-bottom: 15px;
    font-weight: 500;
  }

  .pipeline-type {
    text-align: center;
    font-size: 0.95rem;
    color: #2d3748;
    margin-bottom: 40px;
    padding: 12px;
    background: #edf2f7;
    border-radius: 8px;
    border-left: 4px solid #667eea;
  }

  .pipeline-type strong {
    color: #667eea;
  }

  /* Pipeline Stages */
  .stage-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
    gap: 20px;
  }

  .stage-box {
    flex: 1;
    text-align: center;
    padding: 20px 15px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 1.1rem;
    color: white;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    position: relative;
  }

  .stage-1 { background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%); }
  .stage-2 { background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%); }
  .stage-3 { background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%); }
  .stage-4 { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); }

  .stage-box::after {
    content: '‚Üí';
    position: absolute;
    right: -25px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 2rem;
    color: #cbd5e0;
  }

  .stage-box:last-child::after {
    display: none;
  }

  .stage-subtitle {
    font-size: 0.85rem;
    font-weight: 400;
    margin-top: 5px;
    opacity: 0.95;
  }

  /* Architecture Diagram */
  svg {
    display: block;
    margin: 30px auto;
    background: #f7fafc;
    border-radius: 12px;
    border: 2px solid #e2e8f0;
  }

  /* Component Cards */
  .components-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 40px;
  }

  .component-card {
    background: #f7fafc;
    border-radius: 12px;
    padding: 20px;
    border: 2px solid #e2e8f0;
    transition: all 0.3s ease;
  }

  .component-card:hover {
    border-color: #667eea;
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
    transform: translateY(-2px);
  }

  .component-card h3 {
    color: #667eea;
    font-size: 1.1rem;
    margin-bottom: 12px;
    font-weight: 600;
  }

  .component-card .tech-stack {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
  }

  .tech-badge {
    background: #667eea;
    color: white;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
  }

  .component-card p {
    color: #4a5568;
    font-size: 0.9rem;
    line-height: 1.6;
  }

  .component-card ul {
    margin: 10px 0 0 20px;
    color: #4a5568;
    font-size: 0.85rem;
    line-height: 1.8;
  }

  /* Legend */
  .legend {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin-top: 30px;
    padding: 20px;
    background: #f7fafc;
    border-radius: 12px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    color: #4a5568;
    font-weight: 500;
  }

  .legend-swatch {
    width: 16px;
    height: 16px;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  /* Tooltip */
  .tooltip {
    position: fixed;
    pointer-events: none;
    padding: 12px 16px;
    border-radius: 8px;
    background: #1a202c;
    border: 1px solid #4a5568;
    color: #e2e8f0;
    font-size: 0.8rem;
    line-height: 1.5;
    max-width: 350px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    opacity: 0;
    transition: opacity 0.2s;
    z-index: 100;
  }

  .tooltip.show { opacity: 1; }
  .tooltip strong { color: #81e6d9; }
  .tooltip code {
    background: #2d3748;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.75rem;
    color: #f6ad55;
  }
</style>
</head>
<body>

<div class="container">
  <h1>Phase 3: Concrete Data Pipeline Architecture</h1>
  <p class="subtitle">NYC TLC Taxi Data Pipeline ‚Ä¢ Hybrid Batch + Streaming Architecture</p>

  <div class="pipeline-type">
    <strong>Pipeline Selection:</strong> Hybrid Architecture with Batch Processing (Primary) + Kafka Streaming (Alternative)
  </div>

  <!-- Stage Headers -->
  <div class="stage-header">
    <div class="stage-box stage-1">
      <div>STAGE 1: INGEST</div>
      <div class="stage-subtitle">Data Acquisition</div>
    </div>
    <div class="stage-box stage-2">
      <div>STAGE 2: TRANSFORM</div>
      <div class="stage-subtitle">Bronze ‚Üí Silver ‚Üí Gold</div>
    </div>
    <div class="stage-box stage-3">
      <div>STAGE 3: STORE</div>
      <div class="stage-subtitle">HDFS + PostgreSQL</div>
    </div>
    <div class="stage-box stage-4">
      <div>STAGE 4: VISUALIZE</div>
      <div class="stage-subtitle">Superset Dashboards</div>
    </div>
  </div>

  <!-- Architecture SVG Diagram -->
  <svg id="arch" width="1300" height="700" viewBox="0 0 1300 700">
    <defs>
      <!-- Arrow Markers -->
      <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
        <path d="M0,0 L10,5 L0,10Z" fill="#718096"/>
      </marker>
      <marker id="arrow-batch" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
        <path d="M0,0 L10,5 L0,10Z" fill="#f6ad55"/>
      </marker>
      <marker id="arrow-stream" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
        <path d="M0,0 L10,5 L0,10Z" fill="#38bdf8"/>
      </marker>
      <marker id="arrow-spark" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
        <path d="M0,0 L10,5 L0,10Z" fill="#9f7aea"/>
      </marker>
      <marker id="arrow-viz" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
        <path d="M0,0 L10,5 L0,10Z" fill="#48bb78"/>
      </marker>

      <!-- Gradients -->
      <linearGradient id="gSource" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#f6ad55"/>
        <stop offset="100%" stop-color="#ed8936"/>
      </linearGradient>
      <linearGradient id="gKafka" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#38bdf8"/>
        <stop offset="100%" stop-color="#0891b2"/>
      </linearGradient>
      <linearGradient id="gHDFS" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#fbbf24"/>
        <stop offset="100%" stop-color="#f59e0b"/>
      </linearGradient>
      <linearGradient id="gSpark" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#c084fc"/>
        <stop offset="100%" stop-color="#9f7aea"/>
      </linearGradient>
      <linearGradient id="gBronze" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#e9d5ff"/>
        <stop offset="100%" stop-color="#c084fc"/>
      </linearGradient>
      <linearGradient id="gSilver" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#cbd5e0"/>
        <stop offset="100%" stop-color="#a0aec0"/>
      </linearGradient>
      <linearGradient id="gGold" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#fde68a"/>
        <stop offset="100%" stop-color="#fbbf24"/>
      </linearGradient>
      <linearGradient id="gPostgres" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#60a5fa"/>
        <stop offset="100%" stop-color="#3b82f6"/>
      </linearGradient>
      <linearGradient id="gSuperset" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#6ee7b7"/>
        <stop offset="100%" stop-color="#10b981"/>
      </linearGradient>
      <linearGradient id="gAirflow" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#f9a8d4"/>
        <stop offset="100%" stop-color="#ec4899"/>
      </linearGradient>
    </defs>

    <!-- Stage Background Regions -->
    <rect x="10" y="50" width="280" height="550" rx="12" fill="#fff7ed" opacity="0.3" stroke="#fed7aa" stroke-width="2" stroke-dasharray="5,5"/>
    <rect x="310" y="50" width="340" height="550" rx="12" fill="#faf5ff" opacity="0.3" stroke="#e9d5ff" stroke-width="2" stroke-dasharray="5,5"/>
    <rect x="670" y="50" width="340" height="550" rx="12" fill="#eff6ff" opacity="0.3" stroke="#bfdbfe" stroke-width="2" stroke-dasharray="5,5"/>
    <rect x="1030" y="50" width="250" height="550" rx="12" fill="#f0fdf4" opacity="0.3" stroke="#bbf7d0" stroke-width="2" stroke-dasharray="5,5"/>

    <!-- Stage Labels -->
    <text x="150" y="35" text-anchor="middle" fill="#ea580c" font-size="13" font-weight="700">STAGE 1: INGEST</text>
    <text x="480" y="35" text-anchor="middle" fill="#7c3aed" font-size="13" font-weight="700">STAGE 2: TRANSFORM</text>
    <text x="840" y="35" text-anchor="middle" fill="#2563eb" font-size="13" font-weight="700">STAGE 3: STORE</text>
    <text x="1155" y="35" text-anchor="middle" fill="#059669" font-size="13" font-weight="700">STAGE 4: VISUALIZE</text>

    <!-- STAGE 1: INGEST Components -->
    <!-- NYC TLC API -->
    <g class="node" data-tip="<strong>NYC TLC API</strong><br>Public API providing Yellow/Green/FHV taxi trip parquet files.<br>Source: https://www.nyc.gov/tlc">
      <rect x="30" y="100" width="230" height="70" rx="10" fill="url(#gSource)" opacity="0.95"/>
      <text x="145" y="125" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">NYC TLC Data API</text>
      <text x="145" y="145" text-anchor="middle" fill="#fef3c7" font-size="11">Yellow/Green Taxi Data</text>
      <text x="145" y="160" text-anchor="middle" fill="#fef3c7" font-size="10">(Parquet Format)</text>
    </g>

    <!-- Batch Path Indicator -->
    <g class="node" data-tip="<strong>Batch Ingestion (Primary)</strong><br>Monthly scheduled downloads via Airflow.<br>Script: <code>download_nyc_tlc.py</code>">
      <rect x="30" y="200" width="110" height="50" rx="8" fill="#f6ad55" opacity="0.2" stroke="#f6ad55" stroke-width="2"/>
      <text x="85" y="220" text-anchor="middle" fill="#ea580c" font-size="10" font-weight="700">BATCH PATH</text>
      <text x="85" y="235" text-anchor="middle" fill="#c2410c" font-size="9">(Primary)</text>
    </g>

    <!-- Streaming Path Indicator -->
    <g class="node" data-tip="<strong>Streaming Ingestion (Alternative)</strong><br>Kafka-based real-time ingestion.<br>Components: <code>kafka_producer.py</code> + Spark Kafka Consumer">
      <rect x="150" y="200" width="110" height="50" rx="8" fill="#38bdf8" opacity="0.2" stroke="#38bdf8" stroke-width="2"/>
      <text x="205" y="220" text-anchor="middle" fill="#0891b2" font-size="10" font-weight="700">STREAM PATH</text>
      <text x="205" y="235" text-anchor="middle" fill="#0e7490" font-size="9">(Alternative)</text>
    </g>

    <!-- Kafka -->
    <g class="node" data-tip="<strong>Apache Kafka 3.4</strong><br>Distributed streaming platform.<br>Topic: <code>trips_raw</code> (3 partitions)<br>Bootstrap: kafka:9092<br>Dependencies: Zookeeper 3.8">
      <rect x="30" y="280" width="230" height="70" rx="10" fill="url(#gKafka)" opacity="0.95"/>
      <text x="145" y="305" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">Apache Kafka</text>
      <text x="145" y="325" text-anchor="middle" fill="#cffafe" font-size="11">Topic: trips_raw</text>
      <text x="145" y="340" text-anchor="middle" fill="#cffafe" font-size="10">Port: 9092</text>
    </g>

    <!-- STAGE 2: TRANSFORM Components -->
    <!-- Spark Cluster -->
    <g class="node" data-tip="<strong>Apache Spark 3.1.2</strong><br>Distributed processing engine.<br>Cluster: 1 Master + 1 Worker<br>Master: spark://spark-master:7077<br>History Server: port 18081<br>All ETL jobs executed via Airflow">
      <rect x="330" y="100" width="140" height="70" rx="10" fill="url(#gSpark)" opacity="0.95"/>
      <text x="400" y="125" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">Spark Cluster</text>
      <text x="400" y="145" text-anchor="middle" fill="#e9d5ff" font-size="11">Master + Worker</text>
      <text x="400" y="160" text-anchor="middle" fill="#e9d5ff" font-size="10">:8080 / :7077</text>
    </g>

    <!-- Bronze Layer -->
    <g class="node" data-tip="<strong>Bronze Layer</strong><br>Raw ingested data (immutable).<br>Path: <code>/datalake/nyc/bronze/yellow_tripdata</code><br>Format: Parquet (partitioned by year/month)<br>Job: Direct load or Kafka consumer">
      <rect x="490" y="100" width="140" height="60" rx="10" fill="url(#gBronze)" opacity="0.95"/>
      <text x="560" y="122" text-anchor="middle" fill="#4c1d95" font-size="13" font-weight="700">Bronze Layer</text>
      <text x="560" y="138" text-anchor="middle" fill="#6b21a8" font-size="10">Raw Parquet</text>
      <text x="560" y="152" text-anchor="middle" fill="#6b21a8" font-size="9">HDFS: /bronze/</text>
    </g>

    <!-- Silver Layer -->
    <g class="node" data-tip="<strong>Silver Layer</strong><br>Cleaned &amp; validated data.<br>Path: <code>/datalake/nyc/silver/yellow_tripdata</code><br>Job: <code>nyc_bronze_to_silver.py</code><br>Filters: trip_distance > 0, fare_amount >= 0<br>DQ checks: <code>dq_check_silver.py</code>">
      <rect x="490" y="250" width="140" height="60" rx="10" fill="url(#gSilver)" opacity="0.95"/>
      <text x="560" y="272" text-anchor="middle" fill="#1a202c" font-size="13" font-weight="700">Silver Layer</text>
      <text x="560" y="288" text-anchor="middle" fill="#2d3748" font-size="10">Cleaned Data</text>
      <text x="560" y="302" text-anchor="middle" fill="#2d3748" font-size="9">HDFS: /silver/</text>
    </g>

    <!-- Gold Layer -->
    <g class="node" data-tip="<strong>Gold Layer</strong><br>Aggregated business KPIs.<br>Path: <code>/datalake/nyc/gold/kpis_trips_monthly</code><br>Job: <code>nyc_silver_to_gold.py</code><br>Metrics: trip count, total fare, total tip, avg distance<br>Output: HDFS + PostgreSQL (JDBC)">
      <rect x="490" y="400" width="140" height="60" rx="10" fill="url(#gGold)" opacity="0.95"/>
      <text x="560" y="422" text-anchor="middle" fill="#78350f" font-size="13" font-weight="700">Gold Layer</text>
      <text x="560" y="438" text-anchor="middle" fill="#92400e" font-size="10">Aggregated KPIs</text>
      <text x="560" y="452" text-anchor="middle" fill="#92400e" font-size="9">HDFS: /gold/</text>
    </g>

    <!-- Transform Jobs Labels -->
    <rect x="330" y="230" width="140" height="35" rx="6" fill="#9f7aea" opacity="0.15" stroke="#9f7aea" stroke-width="1.5"/>
    <text x="400" y="248" text-anchor="middle" fill="#6b21a8" font-size="9" font-weight="600">Bronze ‚Üí Silver</text>
    <text x="400" y="260" text-anchor="middle" fill="#7c3aed" font-size="8">nyc_bronze_to_silver.py</text>

    <rect x="330" y="380" width="140" height="35" rx="6" fill="#9f7aea" opacity="0.15" stroke="#9f7aea" stroke-width="1.5"/>
    <text x="400" y="398" text-anchor="middle" fill="#6b21a8" font-size="9" font-weight="600">Silver ‚Üí Gold</text>
    <text x="400" y="410" text-anchor="middle" fill="#7c3aed" font-size="8">nyc_silver_to_gold.py</text>

    <!-- STAGE 3: STORE Components -->
    <!-- HDFS NameNode -->
    <g class="node" data-tip="<strong>HDFS NameNode</strong><br>Hadoop Distributed File System metadata manager.<br>Version: Hadoop 3.2.1<br>Ports: 9870 (UI), 9000 (RPC)<br>Stores Bronze/Silver/Gold layers">
      <rect x="690" y="100" width="150" height="70" rx="10" fill="url(#gHDFS)" opacity="0.95"/>
      <text x="765" y="125" text-anchor="middle" fill="#78350f" font-size="14" font-weight="700">HDFS NameNode</text>
      <text x="765" y="145" text-anchor="middle" fill="#fef3c7" font-size="11">Hadoop 3.2.1</text>
      <text x="765" y="160" text-anchor="middle" fill="#fef3c7" font-size="10">:9870 / :9000</text>
    </g>

    <!-- HDFS DataNode -->
    <g class="node" data-tip="<strong>HDFS DataNode</strong><br>Stores actual data blocks.<br>Port: 9864 (UI)<br>Volume: hdfs-datanode">
      <rect x="690" y="190" width="150" height="55" rx="10" fill="url(#gHDFS)" opacity="0.75"/>
      <text x="765" y="215" text-anchor="middle" fill="#78350f" font-size="13" font-weight="700">HDFS DataNode</text>
      <text x="765" y="232" text-anchor="middle" fill="#92400e" font-size="10">:9864</text>
    </g>

    <!-- PostgreSQL -->
    <g class="node" data-tip="<strong>PostgreSQL 15</strong><br>Data warehouse for structured analytics.<br>Database: nyc<br>Tables: fact_trips_monthly, taxi_zone_lookup, dq_results, job_runs, metrics_pipeline_runs<br>Port: 5432<br>Accessed by Spark (JDBC) and Superset">
      <rect x="860" y="100" width="130" height="70" rx="10" fill="url(#gPostgres)" opacity="0.95"/>
      <text x="925" y="125" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">PostgreSQL</text>
      <text x="925" y="145" text-anchor="middle" fill="#dbeafe" font-size="11">Data Warehouse</text>
      <text x="925" y="160" text-anchor="middle" fill="#dbeafe" font-size="10">DB: nyc :5432</text>
    </g>

    <!-- Storage Layers Labels -->
    <rect x="690" y="270" width="150" height="90" rx="8" fill="#f7fafc" stroke="#cbd5e0" stroke-width="2"/>
    <text x="765" y="290" text-anchor="middle" fill="#2d3748" font-size="11" font-weight="700">Medallion Layers</text>
    <text x="765" y="308" text-anchor="middle" fill="#4a5568" font-size="9">ü•â Bronze: Raw</text>
    <text x="765" y="323" text-anchor="middle" fill="#4a5568" font-size="9">ü•à Silver: Cleaned</text>
    <text x="765" y="338" text-anchor="middle" fill="#4a5568" font-size="9">ü•á Gold: Aggregated</text>
    <text x="765" y="353" text-anchor="middle" fill="#718096" font-size="8">All in HDFS Parquet</text>

    <!-- STAGE 4: VISUALIZE Components -->
    <!-- Superset -->
    <g class="node" data-tip="<strong>Apache Superset 3.1.0</strong><br>Modern data exploration &amp; visualization platform.<br>Connects to PostgreSQL for dashboards.<br>Dashboards: Trip trends, Revenue analysis, DQ metrics<br>Port: 8089<br>Initial setup required">
      <rect x="1050" y="150" width="210" height="80" rx="10" fill="url(#gSuperset)" opacity="0.95"/>
      <text x="1155" y="178" text-anchor="middle" fill="#fff" font-size="15" font-weight="700">Apache Superset</text>
      <text x="1155" y="198" text-anchor="middle" fill="#d1fae5" font-size="11">BI Dashboards</text>
      <text x="1155" y="215" text-anchor="middle" fill="#d1fae5" font-size="10">http://localhost:8089</text>
    </g>

    <!-- Adminer -->
    <g class="node" data-tip="<strong>Adminer</strong><br>Lightweight database management UI.<br>Supports ad-hoc SQL queries.<br>Port: 8082">
      <rect x="1050" y="250" width="210" height="50" rx="10" fill="#60a5fa" opacity="0.3" stroke="#3b82f6" stroke-width="2"/>
      <text x="1155" y="272" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="600">Adminer</text>
      <text x="1155" y="288" text-anchor="middle" fill="#1e3a8a" font-size="9">DB UI :8082</text>
    </g>

    <!-- Orchestration Layer (Bottom) -->
    <g class="node" data-tip="<strong>Apache Airflow 2.9.3</strong><br>Workflow orchestration platform.<br>DAGs: nyc_taxi_batch (monthly), nyc_taxi_kafka_batch (manual), load_taxi_zone_lookup_daily, nyc_phase3_eval<br>Components: Webserver, Scheduler, Metadata DB<br>Port: 8083<br>Credentials: airflow / airflow">
      <rect x="330" y="520" width="660" height="60" rx="12" fill="url(#gAirflow)" opacity="0.9" stroke="#ec4899" stroke-width="2"/>
      <text x="660" y="545" text-anchor="middle" fill="#fff" font-size="16" font-weight="700">Apache Airflow ‚Äì Pipeline Orchestration</text>
      <text x="660" y="565" text-anchor="middle" fill="#fce7f3" font-size="11">4 DAGs | SparkSubmitOperator + PythonOperator | http://localhost:8083</text>
    </g>

    <!-- Data Flow Arrows -->
    <!-- Batch Path: NYC TLC ‚Üí Bronze -->
    <path d="M 145,170 L 145,195" stroke="#f6ad55" stroke-width="3" marker-end="url(#arrow-batch)"/>
    <path d="M 85,250 Q 85,320 110,320 L 480,130" stroke="#f6ad55" stroke-width="3" stroke-dasharray="8,4" marker-end="url(#arrow-batch)"/>
    <text x="200" y="210" fill="#ea580c" font-size="9" font-weight="600">Direct Load</text>

    <!-- Streaming Path: NYC TLC ‚Üí Kafka ‚Üí Spark ‚Üí Bronze -->
    <path d="M 205,250 L 205,280" stroke="#38bdf8" stroke-width="3" marker-end="url(#arrow-stream)"/>
    <path d="M 260,315 L 320,135" stroke="#38bdf8" stroke-width="3" marker-end="url(#arrow-stream)"/>
    <path d="M 470,135 L 485,130" stroke="#38bdf8" stroke-width="3" marker-end="url(#arrow-stream)"/>
    <text x="280" y="240" fill="#0891b2" font-size="9" font-weight="600">Kafka Stream</text>

    <!-- Spark Processing: Bronze ‚Üí Silver ‚Üí Gold -->
    <path d="M 400,170 L 400,245 L 490,280" stroke="#9f7aea" stroke-width="3" marker-end="url(#arrow-spark)"/>
    <path d="M 560,310 L 560,395" stroke="#9f7aea" stroke-width="3" marker-end="url(#arrow-spark)"/>
    <path d="M 400,415 L 490,430" stroke="#9f7aea" stroke-width="3" marker-end="url(#arrow-spark)"/>

    <!-- Storage: Bronze/Silver/Gold ‚Üí HDFS -->
    <path d="M 630,130 L 685,135" stroke="#fbbf24" stroke-width="2.5" marker-end="url(#arrow)"/>
    <path d="M 630,280 L 670,280 L 670,190 L 685,190" stroke="#fbbf24" stroke-width="2.5" marker-end="url(#arrow)"/>
    <path d="M 630,430 L 670,430 L 670,240 L 685,240" stroke="#fbbf24" stroke-width="2.5" marker-end="url(#arrow)"/>

    <!-- Gold ‚Üí PostgreSQL (JDBC) -->
    <path d="M 630,420 Q 750,420 840,135" stroke="#3b82f6" stroke-width="3" marker-end="url(#arrow)"/>
    <text x="720" y="350" fill="#2563eb" font-size="9" font-weight="600">JDBC Write</text>

    <!-- PostgreSQL ‚Üí Superset -->
    <path d="M 990,135 L 1045,190" stroke="#10b981" stroke-width="3" marker-end="url(#arrow-viz)"/>
    <text x="1000" y="155" fill="#059669" font-size="9" font-weight="600">SQL Query</text>

    <!-- PostgreSQL ‚Üí Adminer -->
    <path d="M 990,160 Q 1020,220 1045,275" stroke="#60a5fa" stroke-width="2" stroke-dasharray="4,3" marker-end="url(#arrow)"/>

    <!-- Airflow Orchestration Connections -->
    <path d="M 400,470 L 400,515" stroke="#ec4899" stroke-width="2.5" stroke-dasharray="6,4" marker-end="url(#arrow)"/>
    <path d="M 560,470 L 560,515" stroke="#ec4899" stroke-width="2.5" stroke-dasharray="6,4" marker-end="url(#arrow)"/>
    <text x="480" y="495" fill="#be185d" font-size="9" font-weight="600">Orchestrates</text>

  </svg>

  <!-- Legend -->
  <div class="legend">
    <div class="legend-item"><div class="legend-swatch" style="background:#f6ad55"></div>Batch Ingestion</div>
    <div class="legend-item"><div class="legend-swatch" style="background:#38bdf8"></div>Streaming Ingestion</div>
    <div class="legend-item"><div class="legend-swatch" style="background:#9f7aea"></div>Spark Transformations</div>
    <div class="legend-item"><div class="legend-swatch" style="background:#fbbf24"></div>HDFS Storage</div>
    <div class="legend-item"><div class="legend-swatch" style="background:#3b82f6"></div>PostgreSQL</div>
    <div class="legend-item"><div class="legend-swatch" style="background:#10b981"></div>Visualization</div>
    <div class="legend-item"><div class="legend-swatch" style="background:#ec4899"></div>Orchestration</div>
  </div>

  <!-- Component Details Cards -->
  <div class="components-grid">
    <!-- Ingestion -->
    <div class="component-card">
      <h3>üîΩ Stage 1: Ingestion</h3>
      <p><strong>Batch Path (Primary):</strong> Direct download from NYC TLC API via <code>download_nyc_tlc.py</code>, scheduled monthly.</p>
      <p><strong>Stream Path (Alternative):</strong> Kafka producer publishes to <code>trips_raw</code> topic, consumed by Spark.</p>
      <div class="tech-stack">
        <span class="tech-badge">Python</span>
        <span class="tech-badge">Kafka 3.4</span>
        <span class="tech-badge">Zookeeper 3.8</span>
      </div>
    </div>

    <!-- Transformation -->
    <div class="component-card">
      <h3>‚öôÔ∏è Stage 2: Transformation</h3>
      <p><strong>Medallion Architecture:</strong></p>
      <ul>
        <li><strong>Bronze ‚Üí Silver:</strong> Data cleansing, validation, deduplication</li>
        <li><strong>Silver ‚Üí Gold:</strong> Aggregation, KPI computation, business logic</li>
      </ul>
      <div class="tech-stack">
        <span class="tech-badge">Spark 3.1.2</span>
        <span class="tech-badge">PySpark</span>
        <span class="tech-badge">Hadoop 3.2</span>
      </div>
    </div>

    <!-- Storage -->
    <div class="component-card">
      <h3>üíæ Stage 3: Storage</h3>
      <p><strong>Data Lake:</strong> HDFS with Bronze/Silver/Gold layers (Parquet, partitioned by year/month).</p>
      <p><strong>Data Warehouse:</strong> PostgreSQL 15 with fact tables, DQ logs, and metrics tracking.</p>
      <div class="tech-stack">
        <span class="tech-badge">HDFS</span>
        <span class="tech-badge">PostgreSQL 15</span>
        <span class="tech-badge">Parquet</span>
      </div>
    </div>

    <!-- Visualization -->
    <div class="component-card">
      <h3>üìä Stage 4: Visualization</h3>
      <p><strong>Primary Tool:</strong> Apache Superset for interactive dashboards (trip trends, revenue, DQ metrics).</p>
      <p><strong>Ad-hoc Queries:</strong> Adminer for SQL exploration and debugging.</p>
      <div class="tech-stack">
        <span class="tech-badge">Superset 3.1.0</span>
        <span class="tech-badge">Adminer</span>
      </div>
    </div>

    <!-- Orchestration -->
    <div class="component-card">
      <h3>üéØ Orchestration Layer</h3>
      <p><strong>Apache Airflow</strong> manages all pipeline workflows:</p>
      <ul>
        <li><strong>nyc_taxi_batch:</strong> Monthly batch pipeline</li>
        <li><strong>nyc_taxi_kafka_batch:</strong> Streaming pipeline (manual)</li>
        <li><strong>nyc_phase3_eval:</strong> DQ checks + metrics evaluation</li>
      </ul>
      <div class="tech-stack">
        <span class="tech-badge">Airflow 2.9.3</span>
        <span class="tech-badge">LocalExecutor</span>
      </div>
    </div>

    <!-- Docker -->
    <div class="component-card">
      <h3>üê≥ Docker Orchestration</h3>
      <p><strong>11 Containerized Services:</strong> NameNode, DataNode, Spark (Master + Worker + History), PostgreSQL (2x), Kafka, Zookeeper, Airflow (3x), Superset, Adminer.</p>
      <p><strong>Startup:</strong> <code>docker compose up -d</code></p>
      <div class="tech-stack">
        <span class="tech-badge">Docker Compose</span>
        <span class="tech-badge">11 Services</span>
      </div>
    </div>
  </div>

  <div style="margin-top: 40px; text-align: center; color: #718096; font-size: 0.9rem;">
    <p><strong>Vamshi Krishna Kasarla</strong> | IU MSc Data Science ‚Äì DLMDSEDE02 (Data Engineering) | Phase 3 Submission</p>
  </div>
</div>

<!-- Tooltip Element -->
<div class="tooltip" id="tip"></div>

<script>
  const tip = document.getElementById('tip');
  document.querySelectorAll('.node').forEach(n => {
    n.style.cursor = 'pointer';
    n.addEventListener('mouseenter', e => {
      tip.innerHTML = n.dataset.tip;
      tip.classList.add('show');
    });
    n.addEventListener('mousemove', e => {
      tip.style.left = (e.clientX + 16) + 'px';
      tip.style.top  = (e.clientY + 16) + 'px';
    });
    n.addEventListener('mouseleave', () => tip.classList.remove('show'));
  });
</script>
</body>
</html>
